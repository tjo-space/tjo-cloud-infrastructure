default:
  @just --list

build:
  @nix build .#nixosConfigurations.build-qcow2.config.system.build.qcow2

apply: build
  #!/usr/bin/env sh
  export NIXOS_IMAGE=$(nix path-info --quiet .#nixosConfigurations.build-qcow2.config.system.build.qcow2)/nixos.qcow2
  export TF_VAR_image_path=$NIXOS_IMAGE

  echo "Deploying $NIXOS_IMAGE"
  tofu init
  tofu apply

destroy:
  #!/usr/bin/env sh
  tofu destroy
