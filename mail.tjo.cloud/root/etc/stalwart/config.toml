[authentication.fallback-admin]
# openssl passwd -6
secret = "$6$gxZSzKLDHK5d3fVJ$xKXp7PpC3uLBn0wuw7gbcvfIG5agmBEjBOGQ4nB8xqBglV10eakrllisniFGeyZT.C8CRksVTJ8uNY40oGrcP."
user = "admin"

[server]
hostname = "mail.tjo.cloud"
max-connections = 8192

[server.proxy]
trusted-networks = ["10.0.2.0/24", "fd74:6a6f:0:0200::/56"]

[server.socket]
backlog = 1024
nodelay = true
reuse-addr = true
reuse-port = true

[server.listener.http]
bind = "[::]:8080"
protocol = "http"

[server.listener.https]
bind = "[::]:443"
protocol = "http"
tls.implicit = true

[server.listener.imaptls]
bind = "[::]:993"
protocol = "imap"
tls.implicit = true

[server.listener.sieve]
bind = "[::]:4190"
protocol = "managesieve"

[server.listener.smtp]
bind = "[::]:25"
protocol = "smtp"

[server.listener.submissions]
bind = "[::]:465"
protocol = "smtp"
tls.implicit = true

[directory.id]
type = "oidc"
timeout = "15s"
bind.auth.method = "default"
cache.size = 1048576
cache.ttl.negative = "10m"
cache.ttl.positive = "1h"
endpoint.method = "userinfo"
endpoint.url = "https://id.tjo.cloud/application/o/userinfo/"
fields.email = "email"
fields.full-name = "name"
fields.username = "preferred_username"

[directory.postgresql]
type = "internal"
store = "postgresql"

[store.postgresql]
type = "postgresql"
compression = "lz4"
database = "mail.tjo.cloud_stalwart"
host = "pink.postgresql.tjo.cloud"
user = "mail.tjo.cloud"
password = "%{env:POSTGRESQL_PASSWORD}%"
pool.max-connections = 10
port = 5432
purge.frequency = "0 3 *"
read-from-replicas = true
timeout = "15s"
tls.allow-invalid-certs = false
tls.enable = false

[storage]
directory = "postgresql"
blob = "postgresql"
data = "postgresql"
fts = "postgresql"
lookup = "postgresql"

[email.encryption]
enable = true

[acme.letsencrypt]
directory = "https://acme-v02.api.letsencrypt.org/directory"
challenge = "tls-alpn-01"
contact = ["postmaster@%{DEFAULT_DOMAIN}%"]
domains = ["mail.tjo.cloud"]
cache = "%{BASE_PATH}%/etc/acme"
renew-before = "30d"

[tracer.log]
type = "console"
level = "info"
ansi = true
enable = true

[metrics.prometheus]
enable = true
